# ExampleUserRegistrationOnTheSite
Пример кода Asp.net core Razor Page. Регистрация, восстановление пароля  и удаления пользователя. Рабочий пример можно посмотреть по адресу: https://rsgserver.space    Здесь используется работа с базой данных MySql посредством EF для хранения данных о пользователе. Работа с электронной почтой для подтверждения, восстановления пароля и удаления аккаунта. Также реализовано взаимодействие с Cookie на стороне клиента и сервера для идентификации пользователя.

Описание работы.

1. Пользователь заходит на главную страницу сайта.("/index" Razor Page). Сервер проверяет Cookie. Если в  Cookie на браузере есть email и токен пользователя то происходит переопределение на главную страницу сайта - пункт 3. Если токена нет или нет email то происходит переопределение на страницу авторизации — пункт 2. Срок хранения токена 1 день. Срок хранения email – 30 дней.

2. Страница  авторизации ("/user/login" Razor Page). На данной странице запрашивается email и пароль пользователя. JavaScript проверяет в Cookie есть ли почта пользователя и если она есть то поле email заполняется автоматически. Если пользователь не помнит свой пароль то имеется ссылка «Не помню пароль» при нажатии на которую происходит переадресация на страницу восстановления аккаунта — пункт 5.  Также имеется ссылка «Регистрация» при нажатии на которую происходит перенаправление на страницу регистрации — пункт 4. При заполнении полей и нажатии на кнопку войти происходит проверка введенных данных на ощибки средствами HTML. Если ошибок нет то отправляется запрос на сервер на проверку пользователя. Если все данные введены правильно и пользователь существует тогда сервер обновляет Cookie а именно токен и логин и переодресовывает на главную страницу сайта — пункт 3.

3. Главная страница сайта. (страница "/main" Razor Page).
Каждый раз при входе на главную страницу Cookie проверяется и обновляется автоматически. 
Здесь имеется:
	Ссылка «Выйти из аккаунта» при нажатии на которую происходит посредством  JavaScript обнуление Cookie и переадресация на страницу авторизации — пункт 2.
	Ссылка «Сменить пароль» при нажатии на которую происходит переадресация на страницу изменения пароля — пункт 6. 
	Ссылка «Удалить аккаунт» при нажатии на которую происходит переадресация на страницу удаления аккаунта — пункт 7. 	

4. Страница регистрации нового пользователя. ("/user/registration" Razor Page). Здесь нужно ввести Email Login Password PasswordConfirm и нажать на кнопку зарегистрировать. При нажатии на кнопку зарегистрировать введенные данные проверяются на ошибки средствами HTML и отправляются на сервер. Если пользователь с такой почтой еще не зарегистрирован то сервер создает регистрацию на подтверждение, а ссылку на подтверждение отправляет на Email. После этого переадресует на страницу вывода информации со следующими параметрами: Header – Заявка на регистрацию принята! Text – На вашу электронную почту отправлено письмо. Перейдите по ссылке в письме для подтверждения вашей электронной почты. RedirectPage – страница авторизации — пункт 2. Если такой пользователь был зарегистрирован ранее то сервер переадресует на страницу вывода информации со следующими параметрами. Header – Ошибка регистрации Text – Пользователь с таким адресом электронной почты уже зарегистрирован. RedirectPage – страница авторизации — пункт 2. Если пользователь уже подавал заявку на регистрацию и после этого не прошло еще 3 часа то сервер переадресует на страницу вывода информации со следующими параметрами: Header – Ошибка регистрации Text – Вы уже отправляли запрос на регистрацию ранее. На вашу электронную почту ранее уже отправлялось письмо. Для подтверждения регистрации  перейдите по ссылке в письме. RedirectPage – страница авторизации — пункт 2. После того как пользователь перейдет по ссылке отправляется запрос на сервер "/user/create" для активации аккаунта. Происходит переадресация на страницу вывода информации со следующими параметрами: Header – Аккаунт активирован! Text – Ваша электронная почта успешно подтверждена. RedirectPage – страница авторизации — пункт 2. Если ссылка уже просрочена (прошло больше трех часов) тогда сервер переадресует на страницу вывода информации со следующими параметрами: Header – Ошибка регистрации Text – Ссылка по которой вы перешли ошибочна либо просрочилась. Пройдите регистрацию заново. RedirectPage – страница регистрации нового пользователя — пункт 4. Также должна быть кнопка для выхода из регистрации при нажатии на которую должна происходить переадресация на страницу авторизации — пункт 2.

5. Страница восстановления аккаунта ("/user/recovery" Razor Page)  На данной странице нужно ввести Email  и нажать на кнопку «Восстановить аккаунт».
Данные проверяются средствами HTML и отправляются на сервер. Если данный аккаунт зарегистрирован то сервер создает регистрацию на восстановление и отправляет ссылку на электронную почту пользователя. Далее переадресует на страницу вывода информации со следующими параметрами: Header – Заявка на восстановление аккаунта принята. Text – На вашу электронную почту отправлено сообщение. Для продолжения восстановления перейдите по ссылке в письме. RedirectPage – страница авторизации — пункт 2. Когда пользователь перейдет по ссылке в почте сервер генерирует новый пароль, сохраняет его hash. Далее пароль отправляется на электронную почту пользователя. После этого сервер переадресует пользователя на страницу вывода информации со следующими параметрами: Header – Аккаунт успешно восстановлен! Text – на вашу электронную почту отправлено письмо с новым паролем. RedirectPage – страница авторизации — пункт 2. Если ссылка уже просрочена (прошло больше трех часов) тогда сервер переадресует на страницу вывода информации со следующими параметрами: Header – Ошибка восстановления аккаунта Text – Ссылка по которой вы перешли ошибочна либо просрочилась. Пройдите процесс восстановления аккаунта заново. RedirectPage – страница восстановления аккаунта — пункт 5.

6. Страница изменения пароля. ("/user/changepassword" Razor Page) Здесь нужно ввести новый пароль два раза, старый пароль. Далее посредством HTML проверяется корректность ввода данных и в случае правильности вызывается метод JavaScript в которой проверяется соответствие введенных паролей и в случае ошибки выводится сообщение «Пароли не совпадают». Если пароли совпали считывается электронная почта с Cookie. Почта проверяется на корректность и все эти данные отправляются на сервер. Сервер проверяет есть ли такой пользователь? Если есть проверяет активный пароль и если пароль совпадает сохраняет новый пароль в виде hash. После чего обновляется Cookie происходит переадресация на страницу вывода информации со следующими параметрами: Header – Пароль успешно изменен Text - "" RedirectPage – главная страница сайта — пункт 3.

7. Страница удаления аккаунта. ("/user/registrationdelete" Razor Page) На данной странице требуется ввести пароль, поставить галочку что уведомлен об безвозвратном удалении и по желанию оставить коментарий после чего нажать кнопку удалить. Если все данные введены без ошибок то сервер создает запрос на удаление и отправляет ссылку на почту пользователя. Также происходит перенаправление  на страницу вывода информации со следующими параметрами: Header – Запрос на удаление аккаунта создан. Text – На вашу электронную почту отправлено сообщение с сылкой на подтверждение. Перейдите по ссылке для подтверждения удаления аккаунта. RedirectPage – главная страница — пункт 3. Если пользователь кликает по ссылке то отправляется запрос на сервер "/user/remove" и если она не просрочена то происходит удаление аккаунта. Также происходит перенаправление  на страницу вывода информации со следующими параметрами: Header – Аккаунт полностью удален. Text – Все данные касаемые вашего аккаунта были полностью удалены без возможности восстановления. RedirectPage – страница авторизации — пункт 2. Если ссылка на удаление просрочилась то сервер перенаправляет на страницу вывода информации со следующими параметрами: Header – Ошибка удаления аккаунта. Text – Ссылка на удаления аккаунта не действительна либо просрочилась. Пройдите процедуру удаления аккаунта заново. ReditrectPage – страница авторизации — пункт 2.
